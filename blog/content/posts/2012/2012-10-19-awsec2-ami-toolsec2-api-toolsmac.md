+++
date = "2012-10-19T09:14:20+00:00"
draft = false
tags = ["AWS", "EC2", "ec2-ami-tools", "ec2-api-tools", "mac"]
title = "[AWS]ec2-ami-toolsとec2-api-toolsをmacにインストールする"
+++
<p>現在、AWSを利用してサービスをくみ上げているのですが、レイテンシーを少しでも軽減するために各リージョンにサーバーを用意しようと思います。</p>&#13;
<p>上記に伴い、別リージョンに同じサーバーを立てるため、ami-toolsとapi-toolsをインストールしました。其の手順をメモ。</p>&#13;
<p><br /><strong>AWSのサイトから証明書と鍵を入手します。</strong></p>&#13;
<p><br />鍵の配置と権限変更</p>&#13;
<pre>$ mkidr ~/.ec2&#13;
$ mv pk-*.pem cert-*.pem ~/.ec2&#13;
$ chmod 600 ~/.ec2/*.pem&#13;
</pre>&#13;
<p><strong><br />ec2-ami-toolsとec2-api-toolsをhomebrewでインストール</strong></p>&#13;
<pre>$ brew search ec2&#13;
ec2-ami-tools  ec2-api-tools&#13;
&#13;
$ brew install ec2-api-tools&#13;
Software installed with other package managers causes known problems for&#13;
Homebrew. If a formula fails to build, uninstall MacPorts/Fink and try again.&#13;
==&gt; Downloading http://ec2-downloads.s3.amazonaws.com/ec2-api-tools-1.5.2.5.zip&#13;
######################################################################## 100.0%&#13;
==&gt; Caveats&#13;
Before you can use these tools you must export some variables to your $SHELL&#13;
and download your X.509 certificate and private key from Amazon Web Services.&#13;
&#13;
Your certificate and private key are available at:&#13;
http://aws-portal.amazon.com/gp/aws/developer/account/index.html?action=access-key&#13;
&#13;
Download two ".pem" files, one starting with `pk-`, and one starting with `cert-`.&#13;
You need to put both into a folder in your home directory, `~/.ec2`.&#13;
&#13;
To export the needed variables, add them to your dotfiles.&#13;
 * On Bash, add them to `~/.bash_profile`.&#13;
 * On Zsh, add them to `~/.zprofile` instead.&#13;
&#13;
export JAVA_HOME="$(/usr/libexec/java_home)"&#13;
export EC2_PRIVATE_KEY="$(/bin/ls $HOME/.ec2/pk-*.pem)"&#13;
export EC2_CERT="$(/bin/ls $HOME/.ec2/cert-*.pem)"&#13;
export EC2_HOME="/usr/local/Cellar/ec2-api-tools/1.5.2.5/jars"&#13;
==&gt; Summary&#13;
/usr/local/Cellar/ec2-api-tools/1.5.2.5: 322 files, 15M, built in 45 seconds&#13;
&#13;
$ brew install ec2-ami-tools&#13;
Software installed with other package managers causes known problems for&#13;
Homebrew. If a formula fails to build, uninstall MacPorts/Fink and try again.&#13;
==&gt; Downloading http://s3.amazonaws.com/ec2-downloads/ec2-ami-tools-1.3-45758.zip&#13;
######################################################################## 100.0%&#13;
==&gt; Caveats&#13;
Before you can use these tools you must export some variables to your $SHELL&#13;
and download your X.509 certificate and private key from Amazon Web Services.&#13;
&#13;
Your certificate and private key are available at:&#13;
http://aws-portal.amazon.com/gp/aws/developer/account/index.html?action=access-key&#13;
&#13;
Download two ".pem" files, one starting with `pk-`, and one starting with `cert-`.&#13;
You need to put both into a folder in your home directory, `~/.ec2`.&#13;
&#13;
To export the needed variables, add them to your dotfiles.&#13;
 * On Bash, add them to `~/.bash_profile`.&#13;
 * On Zsh, add them to `~/.zprofile` instead.&#13;
&#13;
export JAVA_HOME="$(/usr/libexec/java_home)"&#13;
export EC2_PRIVATE_KEY="$(/bin/ls $HOME/.ec2/pk-*.pem)"&#13;
export EC2_CERT="$(/bin/ls $HOME/.ec2/cert-*.pem)"&#13;
export EC2_AMITOOL_HOME="/usr/local/Cellar/ec2-ami-tools/1.3-45758/jars"&#13;
==&gt; Summary&#13;
/usr/local/Cellar/ec2-ami-tools/1.3-45758: 87 files, 532K, built in 3 seconds&#13;
</pre>&#13;
<p><strong><br />環境変数を設定</strong></p>&#13;
<pre>$ vim ~/.bashrc&#13;
export JAVA_HOME="$(/usr/libexec/java_home)"&#13;
export EC2_PRIVATE_KEY="$(/bin/ls $HOME/.ec2/pk-*.pem)"&#13;
export EC2_CERT="$(/bin/ls $HOME/.ec2/cert-*.pem)"&#13;
export EC2_HOME="/usr/local/Cellar/ec2-api-tools/1.5.2.5/jars"&#13;
export EC2_AMITOOL_HOME="/usr/local/Cellar/ec2-ami-tools/1.3-45758/jars"&#13;
export EC2_URL="http://ec2.us-west-1.amazonaws.com"&#13;
&#13;
$ source ~/.bashrc&#13;
</pre>&#13;
<p><strong><br />動作テスト</strong></p>&#13;
<pre>$ ec2ver&#13;
1.5.2.5 2012-03-01&#13;
&#13;
$ ec2-describe-regions&#13;
REGION  eu-west-1       ec2.eu-west-1.amazonaws.com&#13;
REGION  sa-east-1       ec2.sa-east-1.amazonaws.com&#13;
REGION  us-east-1       ec2.us-east-1.amazonaws.com&#13;
REGION  ap-northeast-1  ec2.ap-northeast-1.amazonaws.com&#13;
REGION  us-west-2       ec2.us-west-2.amazonaws.com&#13;
REGION  us-west-1       ec2.us-west-1.amazonaws.com&#13;
REGION  ap-southeast-1  ec2.ap-southeast-1.amazonaws.com&#13;
&#13;
$ ec2-describe-instances<br />-&gt; EC2_URLで指定されたリージョンで利用しているインスタンスが表示されます。</pre> 